<!DOCTYPE html>
<html lang="en">
<head>
    <title>Code Pressure Timer</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <style>
        body {
            background: #000;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            /* cursor: none;  Removed to fix disappearing cursor */
        }

        #timer {
            font-size: 20vh; /* Use vh units for responsiveness */
            color: #ff5555;
            text-shadow: 0 0 20px #ff0000;
            margin: 5vh 0;
            transition: all 0.5s;
        }

      .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 15px 30px;
            font-size: 1.2em;
            background: #222;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        input {
            background: #222;
            color: #ff4444;
            border: 2px solid #ff4444;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Orbitron';
            text-align: center;
            width: 120px;
        }

      .danger {
            color: #ff4444;
            border: 2px solid #ff4444;
        }

      .success {
            color: #00ff00;
            border: 2px solid #00ff00;
        }

      .warning {
            color: #ffaa00;
            border: 2px solid #ffaa00;
        }

      .pulse {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        #result { /* New element for displaying results */
            font-size: 1.5em;
            color: #00ff00; /* Green for success */
            margin-top: 10px;
        }
        #timer.urgent {
            animation: urgentPulse 1s infinite; /* Separate urgent pulse animation */
        }
        @keyframes urgentPulse {
            0% { transform: scale(1.05); color: #f00; } /* Redder and more pronounced */
            50% { transform: scale(1.1); color: #a00;}
            100% { transform: scale(1.05); color: #f00; }
        }
    </style>
</head>
<body>
    <div id="timer">00:00</div>
    <div class="buttons">
        <input type="text" id="customTime" placeholder="MM:SS">
        <button class="warning" onclick="startCustomTimer()">CUSTOM</button>
        <button class="danger" onclick="startTimer(600, 600)">10:00</button>
        <button class="danger" onclick="startTimer(900, 900)">15:00</button>
        <button class="success" onclick="done()">DONE</button>
        <button class="warning" onclick="addMoreTime()">+5:00</button>
        <button class="danger" onclick="resetTimer()">RESET</button>
    </div>
    <div id="result"></div>

    <script>
        let endTime, timerInterval, originalDuration, addedTime = 0;
        const alarmSound = new Howl({
            src: ['https://assets.mixkit.co/active_storage/sfx/2570/2570-preview.mp3'],
            volume: 0.7
        });

        function updateDisplay() {
            const remaining = Math.max(endTime - Date.now(), 0);
            const duration = moment.duration(remaining, 'milliseconds');
            document.getElementById('timer').textContent = duration.format("mm:ss", { trim: false });

            const percentLeft = remaining / (originalDuration * 1000);
            document.body.style.background = `hsl(0, ${100 - (percentLeft * 100)}%, 5%)`;
            document.getElementById('timer').style.textShadow = 
                `0 0 ${30 * (1 - percentLeft)}px hsl(0, ${100 - (percentLeft * 50)}%, 50%)`;
        }

        function startTimer(seconds, initialDuration) {
            resetTimer();
            originalDuration = initialDuration;
            addedTime = 0;
            endTime = Date.now() + seconds * 1000;

            updateDisplay(); // Call updateDisplay() initially!

            timerInterval = setInterval(() => {
                updateDisplay();
                if (Date.now() >= endTime) {
                    alarmSound.play();
                    document.getElementById('timer').classList.add('pulse');
                    clearInterval(timerInterval);
                }
            }, 100);
        }

        function startCustomTimer() {
            const input = document.getElementById('customTime').value;
            if (!/^\d{2}:\d{2}$/.test(input)) {
                alert("Please enter a valid time in MM:SS format.");
                return;
            }
            const [minutes, seconds] = input.split(':').map(Number);
            startTimer(minutes * 60 + seconds, minutes * 60 + seconds);
        }

        function addMoreTime() {
            if (!originalDuration) return;

            const maxAdditional = originalDuration * 0.4;
            const remainingAdditional = maxAdditional - addedTime;
            if (remainingAdditional <= 0) {
                alert("You can't add more time.");
                return;
            }

            const additional = Math.min(300, remainingAdditional);
            addedTime += additional;
            originalDuration += additional; // Update originalDuration
            endTime += additional * 1000;
            document.getElementById('timer').classList.add('urgent');
            updateDisplay();
        }

        function done() {
            clearInterval(timerInterval);
            const remaining = Math.max(endTime - Date.now(), 0); // Get remaining time
            const elapsed = originalDuration + addedTime - Math.floor(remaining / 1000); // Correct calculation
            const duration = moment.duration(elapsed, 'seconds');
            document.getElementById('result').textContent = `Elapsed Time: ${duration.format('mm:ss')}`;
            document.getElementById('timer').classList.remove('urgent');
        }

        function resetTimer() {
            clearInterval(timerInterval);
            document.getElementById('timer').textContent = '00:00';
            document.getElementById('timer').style.color = '#ff5555';
            document.getElementById('timer').style.textShadow = '0 0 20px #ff0000';
            document.body.style.background = '#000';
            document.getElementById('timer').classList.remove('pulse', 'urgent');
            document.getElementById('result').textContent = '';
            addedTime = 0;
        }
    </script>
</body>
</html>